# Queue Order - BullMQ Project

–ü—Ä–æ–µ–∫—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ—Ä–µ–¥—è–º–∏ –∑–∞–¥–∞—á –Ω–∞ –±–∞–∑–µ BullMQ –∏ Redis.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üöÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—è–º–∏ –∑–∞–¥–∞—á —Å –ø–æ–º–æ—â—å—é BullMQ
- üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á —Å –ø–æ–º–æ—â—å—é –≤–æ—Ä–∫–µ—Ä–æ–≤
- üìß –ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è email –∏ –¥–∞–Ω–Ω—ã—Ö
- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—á–µ—Ä–µ–¥–∏
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π
- üõ°Ô∏è Graceful shutdown –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 16+
- Redis —Å–µ—Ä–≤–µ—Ä
- npm –∏–ª–∏ yarn

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd queue-order
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
cp env.example .env
```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `.env`:
```env
# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Queue Configuration
QUEUE_NAME=default-queue
CONCURRENCY=5

# Application Configuration
NODE_ENV=development
PORT=3000
```

## –ó–∞–ø—É—Å–∫

### –ó–∞–ø—É—Å–∫ Redis

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Redis —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω. –ï—Å–ª–∏ —É –≤–∞—Å Docker:

```bash
docker run -d -p 6379:6379 redis:alpine
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
npm start
```

–ò–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π:

```bash
npm run dev
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
queue-order/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ redis.js          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis
‚îú‚îÄ‚îÄ queues/
‚îÇ   ‚îî‚îÄ‚îÄ queue.js          # –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π
‚îú‚îÄ‚îÄ workers/
‚îÇ   ‚îî‚îÄ‚îÄ worker.js         # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ processors/
‚îÇ   ‚îú‚îÄ‚îÄ emailProcessor.js  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ email –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ dataProcessor.js   # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ app.js                 # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏

```javascript
const QueueManager = require('./queues/queue');

const queue = new QueueManager('my-queue');
await queue.initialize();
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

```javascript
await queue.addJob('job-name', { data: 'example' }, {
  delay: 5000,        // –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
  priority: 10,       // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞—á–∏
  attempts: 3         // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
});
```

### –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞

```javascript
const JobWorker = require('./workers/worker');

const worker = new JobWorker('my-queue', 5); // 5 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
worker.registerProcessor('job-name', async (data, job) => {
  // –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏
  return { result: 'success' };
});

worker.start();
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```javascript
const stats = await queue.getJobCounts();
console.log(stats);
// {
//   waiting: 5,
//   active: 2,
//   completed: 10,
//   failed: 1
// }
```

## –ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### Email –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

```javascript
const emailProcessor = require('./processors/emailProcessor');

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –≤–æ—Ä–∫–µ—Ä–µ
worker.registerProcessor('send-email', emailProcessor);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ email –∑–∞–¥–∞—á–∏
await queue.addJob('send-email', {
  to: 'user@example.com',
  subject: 'Welcome',
  body: 'Hello!',
  template: 'welcome'
});
```

### Data –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

```javascript
const dataProcessor = require('./processors/dataProcessor');

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –≤–æ—Ä–∫–µ—Ä–µ
worker.registerProcessor('process-data', dataProcessor);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
await queue.addJob('process-data', {
  input: [1, 2, 3, 4, 5],
  operation: 'aggregate',
  options: { method: 'sum' }
});
```

## API

### QueueManager

- `initialize()` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏
- `addJob(name, data, options)` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `getJob(jobId)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ ID
- `getJobs(status, start, end)` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á
- `getJobCounts()` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `pause()` - –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—á–µ—Ä–µ–¥–∏
- `resume()` - –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏
- `close()` - –ó–∞–∫—Ä—ã—Ç–∏–µ –æ—á–µ—Ä–µ–¥–∏

### JobWorker

- `registerProcessor(jobName, processor)` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
- `start()` - –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞
- `stop()` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞
- `getStats()` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–æ—Ä–∫–µ—Ä–∞

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –æ:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Redis
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—á–µ—Ä–µ–¥–µ–π –∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–¥–∞—á
- –û—à–∏–±–∫–∞—Ö –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –æ—á–µ—Ä–µ–¥–µ–π

## Graceful Shutdown

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- `SIGINT` (Ctrl+C)
- `SIGTERM`

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–æ—Ä–∫–µ—Ä—ã
2. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥–∏
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `processors/`
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ –≤–æ—Ä–∫–µ—Ä–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `.env`.

## Troubleshooting

### Redis connection error

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- Redis —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ü–æ—Ä—Ç 6379 –¥–æ—Å—Ç—É–ø–µ–Ω

### Queue not initialized

–í—ã–∑–æ–≤–∏—Ç–µ `await queue.initialize()` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ—á–µ—Ä–µ–¥–∏.

### No processor registered

–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏ —Å –ø–æ–º–æ—â—å—é `worker.registerProcessor()`.

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC
